<!doctype html>
<html>

<head>
  <meta charsset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <meta name="theme-color" content="#fafafa">
  <style>
    * {
      margin: 0;
      padding: 0;
      font-family: 'Courier New', Courier, monospace;
    }

    .grid {
      position: absolute;
      display: block;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      background: black;
      cursor: none;
    }

    .cell {
      color: green;
      position: absolute;
      font-size: 1rem;
    }
  </style>
</head>

<body>
  <div class="grid"></div>
  <script>

    const Cell = (char = ' ', { fgColor = 'green', bgColor = 'black' } = {}) => ({
      char,
      fgColor,
      bgColor,
      isTransperent: () => bgColor == 'black' && char == ' '
    })

    const cellSize = () => {
      const span = document.createElement('span')
      span.className = 'cell'
      span.innerHTML = 'X'
      document.getElementsByTagName('body')[0].appendChild(span)
      const size = [span.offsetWidth, span.offsetHeight]
      span.remove()
      return size
    }

    const gridHTML = (grid, cellWidth, cellHeight) =>
      grid.map((cells, row) =>
        cells.map((cell, col) =>
          cell.isTransperent() ?
            '' :
            `<div class="cell" style="
              background-color: ${cell.bgColor}; 
              color: ${cell.fgColor}; 
              top: ${cellHeight * row}px;
              left: ${cellWidth * col}px;
              width: ${cellWidth * cell.char.length}px;
              height: ${cellHeight}px">
            ${cell.char}
          </div>`.replace(/(\r\n|\n|\r)/g, '').replace(/\s+/g, ' ')
        )).map(_ => _.join('')).join('')

    const mouseXYToColRow = (x, y, cellWidth, cellHeight) => [
      Math.floor(x / cellWidth),
      Math.floor(y / cellHeight)
    ]

    const Grid = window.Grid2 = (cols, rows) => ({
      grid: Array(rows).fill().map(_ => Array(cols).fill().map(_ => Cell())),
      text(chars, firstCharRow, firstCharCol) {
        this.grid = this.grid.map((cells, row) => cells.map((cell, col) =>
          (firstCharRow == row && firstCharCol == col) ?
            Cell(chars, { fgColor: 'yellow' }) :
            cell))
        return this
      },
      cursor(row, col) {
        this.grid = this.grid.map((cells, row) => cells.map((cell, col) =>
          col == cursorCol && row == cursorRow ?
            Cell(cell.char, { fgColor: cell.fgColor, bgColor: 'gray' }) :
            cell))
        return this
      },
      rect(topLeftRow, topLeftCol, width, height) {
        this.grid = this.grid.map((cells, row) =>
          cells.map((cell, col) => {
            if ((row == topLeftRow || row == topLeftRow + height - 1) && col > topLeftCol && col < topLeftCol + width - 1) {
              return Cell('═')
            }
            if ((col == topLeftCol || col == topLeftCol + width - 1) && row > topLeftRow && row < topLeftRow + height - 1) {
              return Cell('║')
            }
            if (col == topLeftCol && row == topLeftRow) {
              return Cell('╔')
            }
            if (col == topLeftCol && row == topLeftRow + height - 1) {
              return Cell('╚')
            }
            if (col == topLeftCol + width - 1 && row == topLeftRow) {
              return Cell('╗')
            }
            if (col == topLeftCol + width - 1 && row == topLeftRow + height - 1) {
              return Cell('╝')
            }
            return cell
          }))
        return this
      }
    })

    const [cellWidth, cellHeight] = cellSize()
    let cursorCol, cursorRow
    const root = document.getElementsByClassName('grid')[0]
    const render = () => {
      const [cols, rows] = [
        Math.floor(Math.max(document.documentElement.clientWidth, window.innerWidth || 0) / cellWidth),
        Math.floor(Math.max(document.documentElement.clientHeight, window.innerHeight || 0) / cellHeight)
      ]

      const [rectX, rectY, rectWidth, rectHeight] = cols > 60 ?
        [Math.floor(cols / 4), Math.floor(rows / 8), Math.floor(cols / 2), Math.floor(rows / 2)] :
        [0 + 3, Math.floor(rows / 8), cols - 3 - 3, Math.floor(rows / 2)]

      const grid = window.grid = Grid(cols, rows)
        .rect(rectY, rectX, rectWidth, rectHeight)
        .text("Welcome stranger.", rectY + 1, rectX + 1)
        .text("https://www.linkedin.com/in/viktorvoronin/", rectY + 2, rectX + 1)
        .cursor(cursorCol, cursorRow)
        .grid

      root.innerHTML = gridHTML(grid, cellWidth, cellHeight)
    }

    root.addEventListener('mousemove', e => {
      [cursorCol, cursorRow] = mouseXYToColRow(e.clientX, e.clientY, cellWidth, cellHeight)
      render()
    });

    window.addEventListener('resize', e => {
      render()
    });

    render()

  </script>
</body>

</html>